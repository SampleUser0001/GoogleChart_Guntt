<html>
<head>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['gantt']});
    google.charts.setOnLoadCallback(drawChart);

    let jobList = [];
    function daysToMilliseconds(days) {
        return days * 24 * 60 * 60 * 1000;
    }

    function minitusToMilliseconds(minitus) {
        return minitus * 60 * 1000;
    }

    function drawChart() {
        let data = new google.visualization.DataTable();
        data.addColumn('string', 'Task ID');
        data.addColumn('string', 'Task Name');
        data.addColumn('date', 'Start Date');
        data.addColumn('date', 'End Date');
        data.addColumn('number', 'Duration');
        data.addColumn('number', 'Percent Complete');
        data.addColumn('string', 'Dependencies');

        data.addRows(
            jobList.map(job => {
                return [
                    job.id,
                    job.task,
                    new Date(job.start),
                    new Date(job.end),
                    null,
                    job.percent_complete,
                    job.dependencies.join(',')
                    
                ]
            }));

        var options = {
        };

        var chart = new google.visualization.Gantt(document.getElementById('chart_div'));

        chart.draw(data, options);
    }

    function load() {
        const input = document.getElementById('job_list_load');
        const filepath = input.files[0];
        console.info("filepath: ", filepath);
        if (filepath) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    
                    jobList = JSON.parse(e.target.result);
                    console.info(jobList);
                    (async function() {
                        await drawChart();
                    })();
                    console.info("drawChart finished.")
                } catch (e) {
                    alert('読み込みに失敗しました。' + e);
                    console.error(e);
                }
            }
            reader.readAsText(filepath);
        } else {
            const errorMessage = 'ファイルが選択されていません。';
            alert(errorMessage);
            console.error(errorMessage);
        }
    }

</script>
</head>
<body>
    <input type="file" id="job_list_load" />
    <button id="job_list_load_button" onclick="load()">Load</button>
    <div id="chart_div"></div>
</body>
</html>
